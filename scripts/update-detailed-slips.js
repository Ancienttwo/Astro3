// æ›´æ–°è¯¦ç»†ç­¾æ–‡æ•°æ®
require('dotenv').config({ path: '.env.local' });
const { createClient } = require('@supabase/supabase-js');

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY;
const supabase = createClient(supabaseUrl, supabaseKey);

async function updateDetailedSlips() {
  console.log('ğŸš€ æ›´æ–°è¯¦ç»†ç­¾æ–‡æ•°æ®...\n');

  try {
    // è·å–å…³å¸åº™è®°å½•
    const { data: temples } = await supabase
      .from('temple_systems')
      .select('*')
      .eq('temple_code', 'guandi')
      .single();

    if (!temples) {
      throw new Error('æœªæ‰¾åˆ°å…³å¸åº™è®°å½•');
    }

    console.log('âœ… æ‰¾åˆ°å…³å¸åº™è®°å½•:', temples.id);

    // è¯¦ç»†ç­¾æ–‡æ•°æ®
    const detailedSlips = [
      // ç¬¬äºŒç­¾ - ç”¨æˆ·æä¾›çš„è¯¦ç»†ç‰ˆæœ¬
      {
        slip_number: 2,
        title: 'ç¬¬äºŒç±¤ å¼µå­æˆ¿éŠèµ¤æ¾ ç”²ä¹™ ä¸Šå‰',
        content: 'ç›ˆè™›æ¶ˆæ¯ç¸½å¤©æ™‚\nè‡ªæ­¤å›ç•¶ç™¾äº‹å®œ\nè‹¥å•å‰ç¨‹æ­¸ç¸®åœ°\næ›´é ˆæ–¹å¯¸å¥½ä¿®ç‚º',
        basic_interpretation: `æ­¤ç±¤ä¸Šå‰ã€‚ç›ˆæ»¿è™›ç©ºï¼Œç”Ÿæ»…ç››è¡°ï¼Œä¹ƒæ˜¯å¤©æ™‚çš„å¾ªç’°ï¼Œä¸€å€‹äººè™•ä¸–ï¼Œå¦‚æœèƒ½å¤ é †å¤©æ™‚ï¼Œè‡ªç„¶æ¨£æ¨£å¥½ã€‚å¦‚æœæƒ³å‰é€”ç„¡é˜»ç¤™ï¼Œä¸€è·¯é¢¨é †ï¼Œé ˆè¦å¿ƒåœ°å¥½å¥½ä¿®ç‚ºå‘å–„æ‰è¡Œã€‚

æ›¾ç»é‡åˆ°ä¸é¡ºé‚çš„è¿‡å»ï¼Œåˆ°ç°åœ¨ä¹Ÿè¯¥æ˜¯è½¬è¿çš„æ—¶å€™äº†ï¼Œä¹‹åä¼šæ¸å…¥ä½³å¢ƒï¼Œä½†ä¸å¯å› æ­¤è€Œéª„çºµã€‚å¦‚èƒ½ä»å¿ƒåšèµ·ï¼Œéšæ—¶éšåœ°éƒ½èƒ½å‘å‡ºå–„çš„å¿µå¤´ï¼Œç§¯ç´¯ç¦è«ï¼Œå¿…ä¼šæœ‰ç¾å¥½çš„æœªæ¥ã€‚æ­¤ç­¾çš„é‡ç‚¹åœ¨äºå¿ƒé‡Œçš„æƒ³æ³•ï¼Œå¦‚èƒ½ä»¥å–„å¿µå‡ºå‘ï¼Œå¿…èƒ½æ’é™¤ä¸‡éš¾è¾¾æˆç›®æ ‡ï¼Œä½†å¦‚æœ‰åæ–œçš„æ­¹å¿µï¼Œåˆ™ä¼šä¸ºè‡ªå·±æ‹›æ¥å„è¿ï¼Œä¸å¯ä¸æ…ã€‚

å•å©šå§»ï¼Œè¡¨ç¤ºæœ‰æˆåŠŸçš„å¸Œæœ›ã€‚å¦‚æœå•è¨´è¨Ÿï¼Œå‰‡å’Œè§£ç‚ºå®œã€‚å•ç–¾ç—…ï¼Œå‰‡å®œå¤šç¦±å‘Šç¥æ˜ä¿ä½‘ã€‚æ‡‰è€ƒåŠŸåï¼Œæœ‰å¸Œæœ›ï¼Œä½†ä¸å¯å¿ƒèºã€‚æ±‚è²¡å¹³å¹³ï¼Œåšäº‹æ¥­å®œæŒ‰æ­¥å°±ç­ï¼Œä¸å¯å¥½é«˜é¨–é ï¼Œæ‰ä¸è‡´å¤±æ•—ã€‚ç¸½ä¹‹ï¼Œä¸å¦„å‹•ï¼Œå†æ­£å¿ƒä¿®å¾·ï¼Œè‡ªç„¶å®‰æ³°ã€‚`,
        categories: ['ä¿®èº«', 'å‰ç¨‹', 'æ™‚é‹', 'å¾·è¡Œ', 'å©šå§»', 'è¨´è¨Ÿ', 'ç–¾ç—…', 'åŠŸå', 'æ±‚è²¡', 'äº‹æ¥­'],
        fortune_level: 'excellent',
        historical_context: `å­æˆ¿åè‰¯ã€‚éŸ“åœ‹äººã€‚è‡ªåšæµªæ²™äº‹å¾Œï¼ˆæŒ‡è¡Œå¼’ç§¦å§‹çš‡ï¼‰åŒ¿ä¸‹é‚³ã€‚éŠåœ®ä¸Šé‡è¡£è¤è€å¤«ã€‚å¢®å±¥å‘½è‰¯å–è·ªé€²ä¹‹ã€‚è€å¤«æ›°ã€‚å­ºå­å¯æ•™ã€‚è¶Šäº”æ—¥æˆä»¥å¤ªå…¬å…µæ³•ã€‚è¬‚å¾Œåä¸‰å¹´ã€‚æ¿ŸåŒ—ç©€åŸå±±ä¸‹ã€‚é»ƒçŸ³å³æˆ‘ä¹Ÿã€‚å¾Œè‰¯ä½ï¼ˆæ¼¢ï¼‰é«˜ç¥–å®šå¤©ä¸‹ã€‚å°ç•™ä¾¯ã€‚å› æ„Ÿé³¥ç›¡å¼“è—ã€‚è¬ç—…æ­¸å…¥ç™½é›²å±±ã€‚å¸«äº‹é»ƒçŸ³è™Ÿèµ¤æ¾å­ã€‚

å¾å‰æœ‰ä¸€å°‘å¹´æ‚£ç—…ï¼Œå å¾—æ­¤ç±¤ï¼Œä¸ä¹…å³å»é€ï¼Œæ­£æ‡‰åœ¨ã€Œå‰ç¨‹æ­¸ç¸®åœ°ã€ä¸€å¥ã€‚åˆæœ‰ä¸€äººå•è¡Œäººï¼Œå å¾—æ­¤ç±¤ï¼Œä¸æ•¸æ—¥å…¶äººå…¼ç¨‹è€Œè‡³ï¼Œäº¦æ‡‰äº†ã€Œç¸®åœ°ã€ä¹‹å¥ã€‚`,
        symbolism: 'ç›ˆè™›æ¶ˆæ¯æŒ‡äº‹ç‰©çš„ç›ˆæ»¿è™›ç©ºå¾ªç’°è®ŠåŒ–ï¼Œå¤©æ™‚ä»£è¡¨è‡ªç„¶æ™‚åºè¦å¾‹ã€‚å‰ç¨‹æ­¸ç¸®åœ°æ„ç‚ºå‰è·¯éœ€è¦æ”¶æ–‚è¬¹æ…ï¼Œæ–¹å¯¸å¥½ä¿®ç‚ºå¼·èª¿å…§å¿ƒå“å¾·ä¿®é¤Šçš„é‡è¦æ€§ã€‚ç¸®åœ°å…¸æ•…ä¾†è‡ªä»™äººèƒ½ç¸®åœ°æˆå¯¸çš„ç¥é€šï¼Œå¯“æ„æ™‚ç©ºè®ŠåŒ–è«æ¸¬ã€‚'
      },

      // ç¬¬ä¸‰ç­¾ - ç”¨æˆ·æä¾›çš„è¯¦ç»†ç‰ˆæœ¬
      {
        slip_number: 3,
        title: 'ç¬¬ä¸‰ç±¤ è³ˆèª¼é‡æ¼¢æ–‡å¸ ç”²ä¸™ ä¸­å‰',
        content: 'è¡£é£Ÿè‡ªç„¶ç”Ÿè™•æœ‰\nå‹¸å›ä¸ç”¨è‹¦å‹å¿ƒ\nä½†èƒ½å­æ‚Œå­˜å¿ ä¿¡\nç¦ç¥¿ä¾†æˆç¦ä¸ä¾µ',
        basic_interpretation: `æ­¤ç±¤ä¸­å‰ã€‚æ­¤ç­¾åªå®œå®ˆæ—§ï¼Œä¸å¯è´ªæ±‚ï¼Œä½†å­˜ä¸­ç›´ï¼Œå´å¾—ä¸¤å¹³ã€‚é¡»ä»¥å­æ‚Œå¿ ä¿¡ä¸ºæœ¬ï¼Œè‡ªæœ‰ç¦ç¦„æ¥æˆä¹‹åº”ï¼Œè‹¥æ€å¼ºå–å¼ºæ±‚ï¼Œåæ‹›æ„å¤–ä¹‹ç¥¸ï¼Œå è€…å¾ªç†å®ˆåˆ†åˆ™å‰ã€‚

ä¸€å€‹äººåœ¨ä¸–ï¼Œåªè¦ç…§æœ¬ä»½å»åšï¼Œè¡£é£Ÿè‡ªç„¶ä¸ç”¨æ„ã€‚ä¿—äº‘ï¼šã€Œå‘½è£¡æœ‰æ™‚çµ‚é ˆæœ‰ï¼Œå‘½è£¡ç„¡æ™‚è«å¼·æ±‚ã€‚ã€å¼·æ±‚å¯Œè²´ï¼Œå¾’å‹å¿ƒåŠ›ï¼Œåè‡´å‚·æ†‚ã€‚å¦‚æœåœ¨å®¶äº‹è¦ªè‡³å­ï¼Œå…„å¼Ÿå‹æ„›ï¼Œåœ¨å¤–å¾…äººå¿ ä¿¡è‡ªç„¶å…§å¤–ç„¡æ€¨ï¼Œç¦æ‚£ä¸ä¾µã€‚

æ­£æ˜¯ï¼šã€Œå¯Œè²´å‰å®šï¼Œä½•é ˆå¼·æ±‚ï¼Œå‹•åˆå¾ªç†ï¼Œå¤©å¿…ä½‘ä¹‹ã€‚éš¨ç·£å®‰ä»½ï¼Œç›´é“è€Œè¡Œï¼Œå¿ƒä¸­ç„¡æ„§ï¼Œè‡ªç„¶å’Œå¹³ã€‚ã€

æŠ½å¾—æ­¤ç±¤ï¼Œè¡¨ç¤ºåªå®œå®ˆèˆŠï¼Œä¸å¯è²ªæ±‚ã€‚å¿ƒä¸­å­˜è‘—æ­£ç›´ï¼Œè‡ªç„¶ç„¡æ†‚ã€‚å•è¬€äº‹ï¼Œé›–æœ‰æˆåŠŸçš„å¸Œæœ›ï¼Œä½†æ™‚é–“ä¸Šæä¹…å»¶ã€‚è«‡å©šå§»ï¼Œåœ¨æ™‚é–“ä¸Šä¹Ÿæ˜¯æ¯”è¼ƒé²å»¶ã€‚å•è¨´è¨Ÿï¼Œå‰‡ä»¥å’Œè§£ç‚ºå®œã€‚å•ç–¾ç—…ï¼Œç›®å‰é‚„ç„¡æ³•ç—Šç™’ï¼Œå°šé ˆå¾…ä¸€æ®µæ™‚é–“ã€‚`,
        categories: ['å®ˆåˆ†', 'å­æ‚Œ', 'å¿ ä¿¡', 'å®‰åˆ†', 'è¬€äº‹', 'å©šå§»', 'è¨´è¨Ÿ', 'ç–¾ç—…', 'éš¨ç·£', 'ä¿®å¾·'],
        fortune_level: 'good',
        historical_context: `è²¾è°Šé‡æ±‰æ–‡å¸ï¼šæ±‰Â·è´¾è°Šï¼Œæ´›é˜³äººã€‚æ–‡å¸æ—¶æ²³å—å®ˆå´èä¹‹ï¼Œåä¸ºåšå£«ã€‚å¹´äºŒåä½™è¶…è¿ï¼Œå²ä¸­è‡³å¤§ä¸­å¤§å¤«ã€‚è¯·æ”¹æ­£æœ”ï¼Œå…´ç¤¼ä¹ï¼Œä¸Šã€Šæ²»å®‰ç­–ã€‹ã€‚ç»›ã€çŒç­‰æ¯ä¹‹ï¼Œå‡ºä¸ºé•¿æ²™ç‹å¤ªå‚…ã€‚è°Šæ—¢è°ªå»ï¼Œæ¸¡æ¹˜æ°´ä½œèµ‹ï¼ŒåŠå±ˆåŸã€‚è®ºè€…è°“ï¼šè´¾ç”Ÿï¼Œç‹ä½æ‰ï¼Œé‡æ±‰æ–‡æ˜ä¸»ï¼Œç»ˆä¸å¤§ç”¨ï¼Œå’æ‚²ä¼¤è€Œæ­»ï¼Œå²‚éå¤©(æ„)ä¹ï¼Ÿ

å¼ å…¬è‰ºä¹ä¸–åŒå±…ï¼šå¼ å…¬è‰ºï¼Œå°å‰å¿å­™å£ä¹¡æ¡¥åŒ—å¼ äººï¼Œç”Ÿäºå…¬å…ƒ578å¹´ï¼Œå’äºå…¬å…ƒ676å¹´ï¼Œå†åŒ—é½ã€åŒ—å‘¨ã€éš‹ã€å”å››ä»£ï¼Œå¯¿ä¹åä¹å²ã€‚å…¬è‰ºè‡ªå¹¼æœ‰æˆå¾·ä¹‹æœ›ï¼Œæ­£å¾·ä¿®èº«ï¼Œç¤¼è®©é½å®¶ï¼Œç«‹ä¹‰å’Œå¹¿å ‚ã€‚åˆ¶å…¸åˆ™ï¼Œè®¾æ¡æ•™ä»¥æˆ’å­ä¾„ï¼Œæ˜¯ä»¥çˆ¶æ…ˆå­å­ï¼Œå…„å‹å¼Ÿå’Œï¼Œå¤«æ­£å¦‡é¡ºï¼Œå§‘å©‰åª³å¬ï¼Œä¹ä»£åŒå±…ï¼Œåˆå®¶ä¹ç™¾äººã€‚

é“å…‰å¹´é—´æœ‰ä¸€äººï¼Œè‡ªæƒæœ‰é’±ï¼Œæƒ³æœ‰é’±æå¾—å®˜çˆµï¼Œåˆ°åº™æŠ½å¾—æ­¤ç­¾ã€‚äººå®¶åŠä»–åšå¯Œå®¶ç¿ï¼Œä¸å¿…å¦„æƒ³åšå®˜ï¼Œä»–ä¸å¬ï¼Œåæ¥èŠ±äº†å¥½å¤šé’±ï¼Œä»æ— æ³•å®ç°ä¼å›¾ï¼Œä¸€æ°”æ­»åœ¨æ—…é€”ä¸Šï¼Œæ­£åº”äº†è¿™é¦–ç­¾è¯—çš„å‰äºŒå¥ã€‚`,
        symbolism: 'è¡£é£Ÿè‡ªç„¶æœ‰æŒ‡åŸºæœ¬ç”Ÿæ´»éœ€æ±‚å¤©ç„¶å…·è¶³ï¼Œä¸ç”¨è‹¦å‹å¿ƒä»£è¡¨ç„¡éœ€éåº¦æ†‚æ…®æ“å¿ƒã€‚å­æ‚Œå¿ ä¿¡æ˜¯åšäººçš„æ ¹æœ¬å››å¾·ï¼Œç¦ç¥¿ä¾†æˆè¡¨ç¤ºè‡ªç„¶æœƒæœ‰å¥½é‹é™è‡¨ï¼Œç¦ä¸ä¾µæ„ç‚ºç½ç¦é‚ªæƒ¡ä¸æœƒä¾µæ“¾æ­£ç›´ä¹‹äººã€‚'
      }
    ];

    // æ›´æ–°æ¯ä¸ªç­¾æ–‡
    for (const slip of detailedSlips) {
      console.log(`ğŸ“ æ›´æ–°ç¬¬${slip.slip_number}ç­¾...`);
      
      const { data, error } = await supabase
        .from('fortune_slips')
        .update({
          title: slip.title,
          content: slip.content,
          basic_interpretation: slip.basic_interpretation,
          categories: slip.categories,
          fortune_level: slip.fortune_level,
          historical_context: slip.historical_context,
          symbolism: slip.symbolism,
          updated_at: new Date().toISOString()
        })
        .eq('temple_system_id', temples.id)
        .eq('slip_number', slip.slip_number)
        .select();

      if (error) {
        console.error(`âŒ æ›´æ–°ç¬¬${slip.slip_number}ç­¾å¤±è´¥:`, error);
      } else {
        console.log(`âœ… æˆåŠŸæ›´æ–°ç¬¬${slip.slip_number}ç­¾`);
        console.log(`   æ ‡é¢˜: ${slip.title}`);
        console.log(`   å†…å®¹: ${slip.content.substring(0, 50)}...`);
      }

      // æ·»åŠ å»¶è¿Ÿ
      await new Promise(resolve => setTimeout(resolve, 200));
    }

    console.log('\nğŸ‰ è¯¦ç»†ç­¾æ–‡æ•°æ®æ›´æ–°å®Œæˆï¼');
    return true;

  } catch (error) {
    console.error('âŒ æ›´æ–°ç­¾æ–‡æ•°æ®æ—¶å‘ç”Ÿé”™è¯¯:', error.message);
    return false;
  }
}

async function main() {
  try {
    const success = await updateDetailedSlips();
    
    if (success) {
      console.log('\nâœ… ä»»åŠ¡å®Œæˆ');
    } else {
      console.log('\nâŒ ä»»åŠ¡å¤±è´¥');
      process.exit(1);
    }

  } catch (error) {
    console.error('\nâŒ æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error.message);
    process.exit(1);
  }
}

main();