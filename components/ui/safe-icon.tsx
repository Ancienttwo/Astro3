import { useEffect, useState } from 'react'
import { 
  Crown, Calendar, User, Database, Shield, Check, Loader2,
  Sparkles, ExternalLink, CheckCircle, AlertTriangle, Trash2,
  Gift, Plus, ChevronRight, Star, Heart, Settings, Search,
  Menu, X, ArrowRight, ArrowLeft, Home, Clock, Save, BarChart3,
  Edit, Trash, Archive, Inbox, Package, Award, Target, Layers,
  Grid, List, MoreVertical, MoreHorizontal, Circle, Square,
  Triangle, Hexagon, Octagon, Bookmark, Filter, Sliders,
  Terminal, Code, Link, Link2, Anchor, Compass, Navigation,
  Navigation2, Map, Crosshair, ZoomIn, ZoomOut, Maximize,
  Maximize2, Minimize, Minimize2, Move, Cpu, Server, Monitor,
  Smartphone, Tablet, Watch, Tv, Radio, Speaker, Bluetooth,
  Cast, Airplay, Power, PowerOff, HardDrive, Disc, Activity,
  Feather, Command, Hash, Type, Bold, Italic, Underline,
  Strikethrough, AlignLeft, AlignCenter, AlignRight, AlignJustify,
  Columns, Sidebar, Layout, LayoutDashboard, LayoutGrid, LayoutList,
  LayoutTemplate
} from 'lucide-react'

// å›¾æ ‡åç§°åˆ°ç»„ä»¶çš„æ˜ å°„
const iconComponents: Record<string, any> = {
  Crown, Calendar, User, Database, Shield, Check, Loader2,
  Sparkles, ExternalLink, CheckCircle, AlertTriangle, Trash2,
  Gift, Plus, ChevronRight, Star, Heart, Settings, Search,
  Menu, X, ArrowRight, ArrowLeft, Home, Clock, Save, BarChart3,
  Edit, Trash, Archive, Inbox, Package, Award, Target, Layers,
  Grid, List, MoreVertical, MoreHorizontal, Circle, Square,
  Triangle, Hexagon, Octagon, Bookmark, Filter, Sliders,
  Terminal, Code, Link, Link2, Anchor, Compass, Navigation,
  Navigation2, Map, Crosshair, ZoomIn, ZoomOut, Maximize,
  Maximize2, Minimize, Minimize2, Move, Cpu, Server, Monitor,
  Smartphone, Tablet, Watch, Tv, Radio, Speaker, Bluetooth,
  Cast, Airplay, Power, PowerOff, HardDrive, Disc, Activity,
  Feather, Command, Hash, Type, Bold, Italic, Underline,
  Strikethrough, AlignLeft, AlignCenter, AlignRight, AlignJustify,
  Columns, Sidebar, Layout, LayoutDashboard, LayoutGrid, LayoutList,
  LayoutTemplate
}

// å›¾æ ‡åç§°åˆ°emojiçš„æ˜ å°„
const iconFallbacks: Record<string, string> = {
  Crown: 'ğŸ‘‘',
  Calendar: 'ğŸ“…',
  User: 'ğŸ‘¤',
  Database: 'ğŸ’¾',
  Download: 'â¬‡ï¸',
  Upload: 'â¬†ï¸',
  RotateCcw: 'ğŸ”„',
  Shield: 'ğŸ›¡ï¸',
  CheckCircle: 'âœ…',
  AlertTriangle: 'âš ï¸',
  Trash2: 'ğŸ—‘ï¸',
  Loader2: 'â³',
  Sparkles: 'âœ¨',
  ExternalLink: 'ğŸ”—',
  Check: 'âœ“',
  Gift: 'ğŸ',
  Plus: 'â•',
  Minus: 'â–',
  ChevronRight: 'â€º',
  ChevronLeft: 'â€¹',
  Star: 'â­',
  Heart: 'â¤ï¸',
  Settings: 'âš™ï¸',
  Search: 'ğŸ”',
  Menu: 'â˜°',
  X: 'âœ•',
  ArrowRight: 'â†’',
  ArrowLeft: 'â†',
  Info: 'â„¹ï¸',
  Mail: 'âœ‰ï¸',
  Eye: 'ğŸ‘ï¸',
  EyeOff: 'ğŸ™ˆ',
  Lock: 'ğŸ”’',
  Unlock: 'ğŸ”“',
  Key: 'ğŸ”‘',
  Home: 'ğŸ ',
  Clock: 'ğŸ•',
  Timer: 'â±ï¸',
  Zap: 'âš¡',
  Award: 'ğŸ†',
  TrendingUp: 'ğŸ“ˆ',
  TrendingDown: 'ğŸ“‰',
  BarChart: 'ğŸ“Š',
  PieChart: 'ğŸ¥§',
  Activity: 'ğŸ’“',
  Globe: 'ğŸŒ',
  MapPin: 'ğŸ“',
  Phone: 'ğŸ“±',
  MessageCircle: 'ğŸ’¬',
  Send: 'âœˆï¸',
  Share: 'ğŸ“¤',
  Copy: 'ğŸ“‹',
  Clipboard: 'ğŸ“‹',
  FileText: 'ğŸ“„',
  Folder: 'ğŸ“',
  Save: 'ğŸ’¾',
  Printer: 'ğŸ–¨ï¸',
  Wifi: 'ğŸ“¶',
  WifiOff: 'ğŸ“µ',
  Battery: 'ğŸ”‹',
  Volume: 'ğŸ”Š',
  VolumeX: 'ğŸ”‡',
  Sun: 'â˜€ï¸',
  Moon: 'ğŸŒ™',
  Cloud: 'â˜ï¸',
  Umbrella: 'â˜‚ï¸',
  Coffee: 'â˜•',
  ShoppingCart: 'ğŸ›’',
  CreditCard: 'ğŸ’³',
  DollarSign: 'ğŸ’µ',
  Percent: '%',
  Hash: '#',
  AtSign: '@',
  Image: 'ğŸ–¼ï¸',
  Camera: 'ğŸ“·',
  Video: 'ğŸ“¹',
  Mic: 'ğŸ¤',
  MicOff: 'ğŸ”‡',
  Headphones: 'ğŸ§',
  Music: 'ğŸµ',
  Film: 'ğŸ¬',
  Book: 'ğŸ“š',
  Bookmark: 'ğŸ”–',
  Tag: 'ğŸ·ï¸',
  Flag: 'ğŸš©',
  Bell: 'ğŸ””',
  BellOff: 'ğŸ”•',
  AlertCircle: 'âš ï¸',
  HelpCircle: 'â“',
  ThumbsUp: 'ğŸ‘',
  ThumbsDown: 'ğŸ‘',
  Smile: 'ğŸ˜Š',
  Frown: 'ğŸ˜”',
  Users: 'ğŸ‘¥',
  UserPlus: 'ğŸ‘¤+',
  UserMinus: 'ğŸ‘¤-',
  UserCheck: 'ğŸ‘¤âœ“',
  UserX: 'ğŸ‘¤âœ•',
  LogIn: 'â¡ï¸',
  LogOut: 'â¬…ï¸',
  RefreshCw: 'ğŸ”„',
  RefreshCcw: 'ğŸ”„',
  Repeat: 'ğŸ”',
  Shuffle: 'ğŸ”€',
  Play: 'â–¶ï¸',
  Pause: 'â¸ï¸',
  Stop: 'â¹ï¸',
  SkipForward: 'â­ï¸',
  SkipBack: 'â®ï¸',
  FastForward: 'â©',
  Rewind: 'âª',
  ChevronUp: 'âŒƒ',
  ChevronDown: 'âŒ„',
  ChevronsUp: 'â«',
  ChevronsDown: 'â¬',
  ChevronsLeft: 'âª',
  ChevronsRight: 'â©',
  Edit: 'âœï¸',
  Edit2: 'âœï¸',
  Edit3: 'âœï¸',
  Trash: 'ğŸ—‘ï¸',
  Archive: 'ğŸ“¦',
  Inbox: 'ğŸ“¥',
  Package: 'ğŸ“¦',
  Gift: 'ğŸ',
  Award: 'ğŸ†',
  Target: 'ğŸ¯',
  Layers: 'ğŸ“š',
  Grid: 'âš',
  List: 'ğŸ“‹',
  MoreVertical: 'â‹®',
  MoreHorizontal: 'â‹¯',
  Circle: 'â—‹',
  Square: 'â–¡',
  Triangle: 'â–³',
  Hexagon: 'â¬¡',
  Octagon: 'â¬¢',
  Star: 'â­',
  Heart: 'â¤ï¸',
  Bookmark: 'ğŸ”–',
  Filter: 'ğŸ”§',
  Sliders: 'ğŸšï¸',
  Terminal: 'ğŸ’»',
  Code: '</> ',
  Link: 'ğŸ”—',
  Link2: 'ğŸ”—',
  Anchor: 'âš“',
  Compass: 'ğŸ§­',
  Navigation: 'ğŸ§­',
  Navigation2: 'ğŸ§­',
  Map: 'ğŸ—ºï¸',
  Crosshair: 'âŠ•',
  ZoomIn: 'ğŸ”+',
  ZoomOut: 'ğŸ”-',
  Maximize: 'â›¶',
  Maximize2: 'â›¶',
  Minimize: 'âŠ–',
  Minimize2: 'âŠ–',
  Move: 'âœ¥',
  Cpu: 'ğŸ–¥ï¸',
  Server: 'ğŸ–¥ï¸',
  Monitor: 'ğŸ–¥ï¸',
  Smartphone: 'ğŸ“±',
  Tablet: 'ğŸ“±',
  Watch: 'âŒš',
  Tv: 'ğŸ“º',
  Radio: 'ğŸ“»',
  Speaker: 'ğŸ”Š',
  Bluetooth: 'ğŸ“¶',
  Cast: 'ğŸ“¶',
  Airplay: 'ğŸ“¶',
  Power: 'âš¡',
  PowerOff: 'â­•',
  HardDrive: 'ğŸ’¾',
  Disc: 'ğŸ’¿',
  Loader: 'â³',
  Activity: 'ğŸ’“',
  Feather: 'ğŸª¶',
  Command: 'âŒ˜',
  Hash: '#',
  Type: 'T',
  Bold: 'B',
  Italic: 'I',
  Underline: 'U',
  Strikethrough: 'S',
  AlignLeft: 'â«¦',
  AlignCenter: 'â«¥',
  AlignRight: 'â«§',
  AlignJustify: 'â«¨',
  Columns: 'â€–',
  Sidebar: 'â«Ÿ',
  Layout: 'âš',
  LayoutDashboard: 'âš',
  LayoutGrid: 'âš',
  LayoutList: 'â˜°',
  LayoutTemplate: 'âš'
}

interface SafeIconProps {
  icon?: string
  fallback?: string
  className?: string
  [key: string]: any
}

export function SafeIcon({ icon, fallback, className, ...props }: SafeIconProps) {
  // ç›´æ¥ä»é¢„åŠ è½½çš„å›¾æ ‡ä¸­è·å–
  const IconComponent = icon ? iconComponents[icon] : null
  
  // å¦‚æœæœ‰å›¾æ ‡ç»„ä»¶ï¼Œæ¸²æŸ“å®ƒ
  if (IconComponent) {
    return <IconComponent className={className} {...props} />
  }

  // ä½¿ç”¨æä¾›çš„åå¤‡æ–¹æ¡ˆæˆ–é»˜è®¤åå¤‡æ–¹æ¡ˆ
  const fallbackEmoji = fallback || iconFallbacks[icon || ''] || 'â—‹'
  return <span className={className} {...props}>{fallbackEmoji}</span>
}

// å¯¼å‡ºå¸¸ç”¨å›¾æ ‡çš„åŒ…è£…ç»„ä»¶
export const SafeCrown = (props: Omit<SafeIconProps, 'icon'>) => 
  <SafeIcon icon="Crown" {...props} />

export const SafeCheck = (props: Omit<SafeIconProps, 'icon'>) => 
  <SafeIcon icon="Check" {...props} />

export const SafeLoader = (props: Omit<SafeIconProps, 'icon'>) => 
  <SafeIcon icon="Loader2" {...props} />

export const SafeSparkles = (props: Omit<SafeIconProps, 'icon'>) => 
  <SafeIcon icon="Sparkles" {...props} />

export const SafeExternalLink = (props: Omit<SafeIconProps, 'icon'>) => 
  <SafeIcon icon="ExternalLink" {...props} /> 